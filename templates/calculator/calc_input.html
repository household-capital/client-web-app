{% extends 'calculator/calc_base.html' %}

{% load static %}
{% load humanize %}
{% load static %}
{% load crispy_forms_tags %}
{% load calc_extras %}

{% block calculator %}

    <div class="d-none d-sm-block calc_hero_container">
        <img src="{% static 'img/hhc/HC-CalcHero.png' %}" class="img-fluid" alt="Responsive image">
        <div class="calc_hero_text">
            <p class="header_text">Our easy two-step calculator
            <p>
            <p class="larger">Savings in your home could help fund your retirement</p>
        </div>
    </div>

    <div class="container cal_background">
        <div class="row ">
            <div class="col-12 text-center">
                <form id="clientForm" method="post">
                    {% csrf_token %}

                    <!-- PURPOSES -->
                    <div class="cal_background_warm">

                        <div class="container cal_container pt-5 pb-5">

                            <p class="x-large"><b>What are you planning to do with additional retirement funds?</b></p>
                            <p>(please select each purpose that might apply)</p>

                            <div class="d-none d-sm-block pt-2"></div>

                            {% if form.errors %}
                                <div class="row justify-content-center pt-3">
                                    <div class="col-4">
                                        {% for key, value in form.errors.items %}{% if key == '__all__' %}{{ value }}
                                        {% endif %}{% endfor %}

                                    </div>
                                </div>
                            {% endif %}

                            <div class="row justify-content-center pt-3">

                                <div id='panelTopUp' class="col-md-2 text-center ticket_background_white ml-2 mr-2 mb-2">

                                    <div class="check-hide">
                                        <input type="checkbox" name="isTopUp"
                                               id="id_isTopUp" {% if form.cleaned_data.isTopUp %}checked{% endif %}>
                                        <i class="d-none d-md-block dot check-dot fas fa-circle"></i><br>
                                        <label class="check-label check-image TopUp"></label>
                                        <div class="d-none d-sm-block pb-2"></div>
                                        <p class="larger pb-1"><b>Top-Up</b></p>
                                        <p class="small">Increase your super, retirement income or contingency funds</p>
                                        <div class="d-none d-sm-block pb-2"></div>
                                    </div>

                                </div>

                                <div id='panelRefi' class="col-md-2 text-center ticket_background_white ml-2 mr-2 mb-2">
                                    <div class="check-hide">
                                        <input type="checkbox" name="isRefi"
                                               id="id_isRefi" {% if form.cleaned_data.isRefi %}checked{% endif %}>
                                        <i class="d-none d-md-block dot check-dot fas fa-circle"></i><br>
                                        <label class="check-label check-image Refi"></label>
                                        <div class="d-none d-sm-block pb-2"></div>
                                        <p class="larger pb-1"><b>Refinance</b></p>
                                        <p class="small">Refinance your existing mortgage (and choose whether to make
                                            repayments)</p>
                                        <div class="d-none d-sm-block pb-2"></div>
                                    </div>
                                </div>

                                <div id='panelLive' class="col-md-2 text-center ticket_background_white ml-2 mr-2 mb-2">
                                    <div class="check-hide">
                                        <input type="checkbox" name="isLive"
                                               id="id_isLive" {% if form.cleaned_data.isLive %}checked{% endif %}>
                                        <i class="d-none d-md-block dot check-dot fas fa-circle"></i><br>
                                        <label class="check-label check-image Live"></label>
                                        <div class="d-none d-sm-block pb-2"></div>
                                        <p class="larger "><b>Live</b></p>
                                        <p class="small">Renovate your home or help fund your transport and travel</p>
                                        <div class="d-none d-sm-block pb-2"></div>
                                    </div>
                                </div>

                                <div id='panelGive' class="col-md-2 text-center ticket_background_white ml-2 mr-2 mb-2">
                                    <div class="check-hide">
                                        <input type="checkbox" name="isGive"
                                               id="id_isGive" {% if form.cleaned_data.isGive %}checked{% endif %}>
                                        <i class="d-none d-md-block dot check-dot fas fa-circle"></i><br>
                                        <label class="check-label check-image Give"></label>
                                        <div class="d-none d-sm-block pb-2"></div>
                                        <p class="larger "><b>Give</b></p>
                                        <p class="small">Help your family with funding a home deposit, education
                                            expenses
                                            etc</p>
                                        <div class="d-none d-sm-block pb-2"></div>
                                    </div>
                                </div>

                                <div id='panelCare' class="col-md-2 text-center ticket_background_white ml-2 mr-2 mb-2">
                                    <div class="check-hide">
                                        <input type="checkbox" name="isCare"
                                               id="id_isCare" {% if form.cleaned_data.isCare %}checked{% endif %}>
                                        <i class="d-none d-md-block dot check-dot fas fa-circle"></i><br>
                                        <label class="check-label check-image Care"></label>
                                        <div class="d-none d-sm-block pb-2"></div>
                                        <p class="larger "><b>Care</b></p>
                                        <p class="small">Fund your medical expenses, in-home care or aged care
                                            requirements</p>
                                        <div class="d-none d-sm-block pb-2"></div>
                                    </div>
                                </div>

                            </div>

                        </div>

                    </div>

                    <!-- ABOUT YOU -->

                    <div class="cal_background_white">

                        <div class="container cal_container-sm pb-5 pt-5">

                            <p class="x-large"><b>Tell us about yourself?</b></p>

                            <div class="row justify-content-center ">
                                <div class="col-8">


                                    <div class="radio-hide">

                                        <div class="row pt-1 pb-2 justify-content-center">
                                            {% for choice in form.loanType.field.choices reversed %}
                                                <div class="col-6">

                                                    <input {% if choice.0|intval == form.loanType.value|intval %}checked="checked" {% endif %}
                                                           id=loanType_{{ choice.1 }} type="radio"
                                                           name="loanType"
                                                           value={{ choice.0 }}>

                                                    <p class="small pb-2">{{ choice.1 }}</p>


                                                    <label class="radio-label {{ choice.1 }}"
                                                           for=loanType_{{ choice.1 }}></label>


                                                </div>

                                            {% endfor %}
                                        </div>
                                    </div>

                                    <div id="div_id_name" class="form-group row justify-content-center">
                                        <div class="col-6 pb-3">
                                            <p class="small pb-1">Your age</p>
                                            <input type="text" name="age_1" required
                                                   class="textinput textInput form-control" id="id_age_1"
                                                   {% if form.age_1.value != None %}value="{{ form.age_1.value }}"{% endif %}>
                                            {{ form.age_1.errors }}
                                        </div>
                                        <div class="col-6">
                                            <p class="small pb-1">Partner's age</p>
                                            <input type="text" name="age_2"
                                                   class="textinput textInput form-control" id="id_age_2"
                                                   {% if form.age_2.value != None %}value="{{ form.age_2.value }}"{% endif %}>
                                            {{ form.age_2.errors }}

                                        </div>

                                        <br><br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ABOUT YOUR HOME -->
                    <div class="cal_background_warm">

                        <div class="container cal_container-sm pt-5 pb-5">

                            <p class="x-large"><b>Tell us about your home?</b></p>

                            <div class="d-none d-sm-block pt-2"></div>
                            <div class="row justify-content-center pt-3">


                                <div class="col-md-8">

                                    <div class="radio-hide">
                                        <div class="row pt-1 pb-2 justify-content-center">
                                            {% for choice in form.dwellingType.field.choices %}
                                                <div class="col-6">
                                                    <input {% if choice.0|intval == form.dwellingType.value|intval %}checked="checked" {% endif %}
                                                           id={{ choice.1 }} type="radio"
                                                           name="dwellingType"
                                                           value={{ choice.0 }}>
                                                    <p class="small pb-2">{{ choice.1 }}</p>
                                                    <label class="radio-label {{ choice.1 }} "
                                                           for={{ choice.1 }}></label>


                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>


                                    <div class="col-12">
                                        <p class="small pb-1">Postcode</p>
                                        <div id="div_id_name" class="form-group row ">
                                            <input type="text" name="postcode" required
                                                   class="textinput textInput form-control" id="id_postcode"
                                                   {% if form.postcode.value != None %}value="{{ form.postcode.value }}"{% endif %}>
                                            {{ form.postcode.errors }}
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <p class="small pb-1">Estimated value</p>
                                        <div id="div_id_valuation" class="form-group row ">
                                            <input type="text" name="valuation"
                                                   class="textinput textInput form-control" required id="id_valuation"
                                                   {% if form.valuation.value != None %}value="{{ form.valuation.value }}"{% endif %}>
                                            {{ form.valuation.errors }}
                                        </div>


                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SUMMARY -->
                    <div class="cal_background_white">

                        <div class="container cal_container-sm pb-5 pt-5">


                            <div class="row justify-content-center">
                                <div class="col-md-7 text-center">
                                    <button type="submit" value="Submit" form="clientForm"
                                            class="btn btn-hhcGold btn-lg">
                                        &nbsp;&nbsp;See your Summary&nbsp;&nbsp;
                                    </button>
                                    <div class="pt-2"></div>
                                    {% if form.errors %}
                                        <p class="errorlist">Please check input errors above</p>{% endif %}
                                </div>
                                <br> <br>
                            </div>
                        </div>

                        <input type='hidden' name="referrer" id="id_referrer"
                               value="{{ request.META.HTTP_REFERER }}">
                    </div>

                </form>

                <div class="row justify-content-center">
                    <div class="col-md-8 text-center">
                        {% for message in messages %}
                            <p{% if message.tags == 'error' %} class="alert alert-info"{% endif %}
                                    {% if message.tags == 'success' %} class="alert alert-success"{% endif %}>
                                {{ message }}</p>
                        {% endfor %}

                    </div>
                </div>

            </div>
        </div>
    </div>
    <br><br>
{% endblock %}

{% block javascript %}
    <script>

        function hideAge2(obj) {
            if (obj.is(':checked')) {
                $('#id_age_2').removeAttr('required');
                $('#id_age_2').attr("disabled", "");
                $('#id_age_2').prop("value", "");

            }
        }

        function showAge2(obj) {
            if (obj.is(':checked')) {
                $('#id_age_2').removeAttr('disabled');
                $('#id_age_2').attr("required", "")
            }
        }

        function currency(obj) {
            var currentValue = obj.prop("value").replace(/[$,]+/g, "");
            if ((isNaN(currentValue)) || (currentValue == 0)) {

            } else {
                var output = new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(currentValue);
                obj.prop("value", output);
            }
        }

        $(document).ready(function () {

            hideAge2($('#loanType_Single'));

            showAge2($('#loanType_Couple'));


            $('#id_name').focus();


            $('#loanType_Single').click(function () {
                hideAge2($(this));
            });

            $('#loanType_Couple').click(function () {
                showAge2($(this));
            });

            $('#id_valuation').change(function () {
                currency($(this));
            });

            $("#panelTopUp").click(function () {
                $("#id_isTopUp").click();
            });
            $("#panelRefi").click(function () {
                $("#id_isRefi").click();
            });
            $("#panelLive").click(function () {
                $("#id_isLive").click();
            });
            $("#panelGive").click(function () {
                $("#id_isGive").click();
            });
            $("#panelCare").click(function () {
                $("#id_isCare").click();
            })


        })


    </script>

{% endblock %}


